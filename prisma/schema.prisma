// SQLite for quick start. Switch to PostgreSQL later if needed.
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(cuid())
  googleId     String?  @unique
  email        String   @unique
  name         String?
  avatar       String?
  refreshToken String?

  // NEW
  lastSeen     DateTime?   // no @default(now())

  meetingsCreated  Meeting[]       @relation("MeetingsCreated")
  meetingsAttended MeetingAttendee[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}



model Meeting {
  id             String            @id @default(cuid())
  title          String
  description    String?
  subject        String?
  level          String? // 1ere, 2eme, 3eme, Master
  specialization String? // ISI, etc.
  startTime      DateTime
  endTime        DateTime
  location       String? // Room name
  onlineUrl      String? // Zoom, Meet link
  createdById    String
  createdBy      User              @relation("MeetingsCreated", fields: [createdById], references: [id])
  attendees      MeetingAttendee[]
  googleEventId  String? // event id in creator calendar
  isPrivate      Boolean           @default(false)
  password       String?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt

  @@index([subject, level, specialization, startTime])
}

model MeetingAttendee {
  id        String @id @default(cuid())
  meetingId String
  userId    String
  status    String @default("going") // going, interested

  meeting   Meeting  @relation(fields: [meetingId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@unique([meetingId, userId])
}

model Session {
  id        String   @id
  sid       String   @unique
  data      String
  expiresAt DateTime
}
